<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guider Registration - Pearl Guide</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <link rel="stylesheet" href="../css/guide-register.css" />
  </head>
  <body>
    <div class="form-container">
      <h2 class="text-center mb-4">
        <i class="fas fa-user-plus"></i> Guider Registration
      </h2>

      <form action="#" method="POST">
        <!-- Step 1 -->
        <div id="step1">
          <div class="mb-3">
            <label for="fullname" class="form-label"
              ><i class="fas fa-user"></i> Full Name</label
            >
            <input
              type="text"
              id="fullname"
              name="fullname"
              class="form-control"
              placeholder="John Doe"
              required
            />
          </div>

          <div class="mb-3">
            <label for="email" class="form-label"
              ><i class="fas fa-envelope"></i> Email</label
            >
            <input
              type="email"
              id="email"
              name="email"
              class="form-control"
              placeholder="example@mail.com"
              required
            />
          </div>

          <div class="mb-3">
            <label for="password" class="form-label"
              ><i class="fas fa-lock"></i> Password</label
            >
            <input
              type="password"
              id="password"
              name="password"
              class="form-control"
              required
            />
          </div>

          <div class="mb-3">
            <label for="confirm-password" class="form-label"
              ><i class="fas fa-lock"></i> Confirm Password</label
            >
            <input
              type="password"
              id="confirm-password"
              name="confirm-password"
              class="form-control"
              required
            />
          </div>

          <button
            type="button"
            class="btn btn-primary w-100"
            onclick="nextStep()"
          >
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>

        <!-- Step 2 -->
        <div id="step2" style="display: none">
          <div class="mb-3">
            <label for="dob" class="form-label"
              ><i class="fas fa-calendar-alt"></i> Date of Birth</label
            >
            <input
              type="date"
              id="dob"
              name="dob"
              class="form-control"
              required
            />
          </div>

          <div class="mb-3">
            <label for="phone" class="form-label"
              ><i class="fas fa-phone"></i> Contact Number</label
            >
            <input
              type="tel"
              id="phone"
              name="phone"
              class="form-control"
              placeholder="+94 712345678"
              required
            />
          </div>

          <div class="mb-3">
            <label for="gender" class="form-label"
              ><i class="fas fa-venus-mars"></i> Gender</label
            >
            <select id="gender" name="gender" class="form-select">
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="experience" class="form-label"
              ><i class="fas fa-briefcase"></i> Years of Experience</label
            >
            <input
              type="number"
              id="experience"
              name="experience"
              class="form-control"
              min="0"
              max="50"
            />
          </div>

          <div class="mb-3">
            <label for="languages" class="form-label"
              ><i class="fas fa-language"></i> Languages Spoken</label
            >
            <input
              type="text"
              id="languages"
              name="languages"
              class="form-control"
              placeholder="English, Tamil, Sinhala"
            />
          </div>

          <div class="mb-3">
            <label for="specialization" class="form-label"
              ><i class="fas fa-route"></i> Specialization</label
            >
            <input
              type="text"
              id="specialization"
              name="specialization"
              class="form-control"
              placeholder="Adventure, Historical, Cultural"
            />
          </div>

          <div class="mb-3">
            <label for="photo" class="form-label"
              ><i class="fas fa-image"></i> Profile Picture</label
            >
            <input
              type="file"
              id="photo"
              name="photo"
              class="form-control"
              accept="image/*"
            />
          </div>

          <div class="mb-3">
            <label for="idproof" class="form-label"
              ><i class="fas fa-id-card"></i> ID / License Upload</label
            >
            <input
              type="file"
              id="idproof"
              name="idproof"
              class="form-control"
              accept="image/*,.pdf"
            />
          </div>

          <div class="form-check mb-3">
            <input
              type="checkbox"
              id="terms"
              name="terms"
              class="form-check-input"
              required
            />
            <label for="terms" class="form-check-label"
              >I agree to PearGuide's Terms and Conditions</label
            >
          </div>

          <button
            type="button"
            class="btn btn-secondary w-100 mb-2"
            onclick="prevStep()"
          >
            <i class="fas fa-arrow-left"></i> Back
          </button>

          <button type="submit" class="btn btn-success w-100">
            <i class="fas fa-paper-plane"></i> Register
          </button>
        </div>
      </form>
      <div class="register-link">
        Already have an account?
        <a href="/pages/guider-login.html">login</a>
      </div>
    </div>

    <script>
      function nextStep() {
        document.getElementById("step1").style.display = "none";
        document.getElementById("step2").style.display = "block";
      }
      function prevStep() {
        document.getElementById("step2").style.display = "none";
        document.getElementById("step1").style.display = "block";
      }

      // Handle Guider registration submit -> backend -> redirect to GuiderDash
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        if (!form) return;

        form.addEventListener("submit", async function (e) {
          e.preventDefault();

          const fullName = document.getElementById("fullname")?.value?.trim();
          const email = document.getElementById("email")?.value?.trim();
          const password = document.getElementById("password")?.value || "";
          const confirm =
            document.getElementById("confirm-password")?.value || "";
          const phone = document.getElementById("phone")?.value?.trim() || null;

          if (!fullName || !email || !password || !confirm) {
            alert("Please fill required fields");
            return;
          }
          if (password !== confirm) {
            alert("Passwords do not match");
            return;
          }

          const username = email.split("@")[0];

          try {
            const res = await fetch("/api/auth/signup", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                username,
                email,
                password,
                full_name: fullName,
                phone,
                user_type: "guider",
              }),
            });
            const data = await res.json();
            if (!res.ok || !data.success)
              throw new Error(data.message || "Registration failed");
            if (data.token) localStorage.setItem("token", data.token);
            window.location.href = data.redirect || "/pages/GuiderDash.html";
          } catch (err) {
            alert(err.message || "An error occurred");
          }
        });
      });
    </script>
  </body>
</html>
